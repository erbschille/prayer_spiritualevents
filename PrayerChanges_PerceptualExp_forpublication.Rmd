---
title: "Prayer Changes Perceptual and Other Experiences"
date: "2024-03-05"
output: html_document
---

```{r global_options, include = F}
#setting up file
knitr::opts_chunk$set(echo=F, warning=F, cache=F, message=F)
```

# Setup & Loading Data

```{r}
#loading in relevant scripts and libraries
source("./scripts_general/dependencies.R")
source("./scripts_general/custom_funs.R")
source("./scripts_general/var_recode_contrast.R")

select <- dplyr::select
```

## Study 1

Worth noting that all responses for study 1 are yes/no. No frequency responses.

```{r}
# loading study 1 data set
d_i_m <- read_csv("./data/d_i_m.csv") %>%
  mutate(
    question = factor(question), 
    category = factor(category, levels = c("relabeled", "outer_sensory", "presence", "weird")),
    site = factor(site, levels = levels_site),
    country = factor(country, levels = levels_country),
    religion = factor(religion, levels = levels_religion),
    prayfreqmin_cat = recode_factor(
      prayfreqmin,
      `1` = "0-15 minutes",
      `2` = "15-30 minutes",
      `3` = "30-60 minutes",
      `4` = ">60 minutes")
  )

# creating useful data frames for later analyses
d_i_m_sum <- d_i_m %>%
  group_by(
    subject_id, country, site, religion, 
    servicesperweek, prayfreqmin, prayfreqmin_cat, prayfreqmin_bin, christian, category) %>%
  summarise(spev_score = mean(response, na.rm = T)) %>%
  ungroup() 

d_i_m_sum_all <- d_i_m %>%
  group_by(
    subject_id, country, site, religion, 
    servicesperweek, prayfreqmin, prayfreqmin_cat, prayfreqmin_bin, christian) %>%
  summarise(spev_score = mean(response, na.rm = T)) %>%
  ungroup()

# setting contrasts (effect-coding)
contrasts(d_i_m$question) <- contr_effect_fun(d_i_m, "question", "white_light") # drop white light
contrasts(d_i_m$country) <- contrasts_country # drop US
contrasts(d_i_m$site) <- contrasts_site # drop urban
contrasts(d_i_m$religion) <- contrasts_religion # drop local
contrasts(d_i_m$category) <- contr_effect_fun(d_i_m, "category", "weird") #drop weird

contrasts(d_i_m_sum$country) <- contrasts_country
contrasts(d_i_m_sum$site) <- contrasts_site
contrasts(d_i_m_sum$religion) <- contrasts_religion

contrasts(d_i_m_sum_all$country) <- contrasts_country
contrasts(d_i_m_sum_all$site) <- contrasts_site
contrasts(d_i_m_sum_all$religion) <- contrasts_religion
```

## Study 2

```{r}
# loading study 2 data set
d_e_m <- read_csv("./data/d_e_m.csv") %>% 
  mutate(
    question = factor(question), 
    category = factor(category, levels = c("relabeled", "outer_sensory", "presence", "weird")),
    country = factor(country, levels = levels_country),
    population = factor(population),
    population = droplevels(population),
    prayminday_imp0_cat = recode_factor(
      prayminday_imp0,
      `0` = "not at all",
      `1` = "0-15 minutes",
      `2` = "15-30 minutes",
      `3` = "30-60 minutes",
      `4` = ">60 minutes")
  )

# creating useful data frames for later analyses
d_e_m_sum <- d_e_m %>%
  group_by(
    subject_id, country, population, 
    prayatall, prayminday, prayminday_cat, prayminday_imp0, prayminday_imp0_cat, category) %>%
  summarise(spev_score = mean(response, na.rm = T)) %>%
  ungroup()

d_e_m_sum_all <- d_e_m %>%
  group_by(
    subject_id, country, population, 
    prayatall, prayminday, prayminday_cat, prayminday_imp0, prayminday_imp0_cat) %>%
  summarise(spev_score = mean(response, na.rm = T)) %>%
  ungroup()

# setting contrasts (effect-coding)
contrasts(d_e_m$question) <- contr_effect_fun(d_e_m, "question", "spiritual_healing") # drop spiritual healing
contrasts(d_e_m$country) <- contrasts_country # drop US
contrasts(d_e_m$population) <- cbind("_char" = c(1, -1)) # drop gen pop
contrasts(d_e_m$category) <- contr_effect_fun(d_e_m, "category", "weird") # drop weird

contrasts(d_e_m_sum$country) <- contrasts_country
contrasts(d_e_m_sum$population) <- contrasts_religion

# setting contrasts (effect-coding)
contrasts(d_e_m_sum_all$country) <- contrasts_country
contrasts(d_e_m_sum_all$population) <- contrasts_religion
```
```{r}
# loading study 2 data set -- FREQUENCY data
d_e_m_f <- read_csv("./data/d_e_m_f.csv") %>% 
  mutate(
    question = factor(question), 
    category = factor(category, levels = c("relabeled", "outer_sensory", "presence", "weird")),
    country = factor(country, levels = levels_country),
    population = factor(population),
    population = droplevels(population),
    prayminday_imp0_cat = recode_factor(
      prayminday_imp0,
      `0` = "not at all",
      `1` = "0-15 minutes",
      `2` = "15-30 minutes",
      `3` = "30-60 minutes",
      `4` = ">60 minutes"),
    howr_num = ifelse(epi_demo_howr == "Missing Data", NA,
                      as.numeric(factor(epi_demo_howr, 
                                        levels = c("Strongly disagree", "Disagree", "Neither agree nor disagree", "Agree", "Strongly agree"))))
  )

# creating useful data frames for later analyses
d_e_m_f_sum <- d_e_m_f %>%
  group_by(
    subject_id, country, population, 
    prayminday_imp0, prayminday_imp0_cat, category, howr_num) %>%
  summarise(spev_score_f = mean(response, na.rm = T)) %>%
  mutate(spev_score_f_scaled = spev_score_f/5) %>%
  ungroup()

d_e_m_f_sum_all <- d_e_m_f %>%
  group_by(
    subject_id, country, population, 
    prayminday_imp0, prayminday_imp0_cat, howr_num) %>%
  summarise(spev_score_f = mean(response, na.rm = T)) %>%
  mutate(spev_score_f_scaled = spev_score_f/5) %>%
  ungroup()

# setting contrasts (effect-coding)
contrasts(d_e_m_f$question) <- contr_effect_fun(d_e_m_f, "question", "spiritual_healing") # drop spiritual healing
contrasts(d_e_m_f$country) <- contrasts_country # drop US
contrasts(d_e_m_f$population) <- cbind("_char" = c(1, -1)) # drop gen pop
contrasts(d_e_m_f$category) <- contr_effect_fun(d_e_m_f, "category", "weird") # drop weird

contrasts(d_e_m_f_sum$country) <- contrasts_country
contrasts(d_e_m_f_sum$population) <- contrasts_religion

# setting contrasts (effect-coding)
contrasts(d_e_m_f_sum_all$country) <- contrasts_country
contrasts(d_e_m_f_sum_all$population) <- contrasts_religion
```

## Study 3

```{r}
# loading study 3 data sets
d_p_m <- read_csv("./data/d_p_m.csv")%>% 
  mutate(
    religion_denom = factor(religion_denom), 
    question = factor(question),
    question_lab = factor(question_lab)
    )

d_p_m_sum <- read_csv("./data/d_p_m_sum.csv") %>% 
  mutate(
    religion_denom = factor(religion_denom),
    spev_score_scaled = spev_score/4,
    pray_freq_PEW = factor(pray_freq_PEW, levels = c("Never", "Seldom", "A few times a month", "Once a week", "A few times a week", "Once a day", "Several times a day"))
    )

d_p_demo <- read_csv("./data/d_demo_prolific.csv") %>% 
  mutate(demo_religimp_num = as.numeric(factor(`demo_religimp-PEW`,
                                               levels = c("Not at all important", "Not too important", "Somewhat important", "Very important"))))

spev_key <- read_csv("./data/spev_key.csv")

# setting contrasts (effect-coding)
contrasts(d_p_m$religion_denom) <- contr_effect_fun(
  d_p_m, "religion_denom", "More than one religion/spirituality") # drop more than one religion/spirituality
contrasts(d_p_m$question) <- contr_effect_fun(
  d_p_m, "question", "spiritualevents_22") # drop spiritual healing
contrasts(d_p_m$question_lab) <- contr_effect_fun(
  d_p_m, "question_lab", "healing_self") # drop spiritual healing

contrasts(d_p_m_sum$religion_denom) <- contr_effect_fun(d_p_m_sum, "religion_denom", "More than one religion/spirituality") # drop more than one relig
```


# Analysis 1: Prayer Increases Spiritual Presence Events

## Study 1

**An informal summary**: above and beyond differences across countries, rural vs. urban locations, and religious groups, the more frequently a person reported praying, the more spiritual events they reported having experienced. This is robust to many analytic decisions, including modeling responses at the item level vs. modeling average scores on the Spiritual Events scale and considering sample characteristics as fixed effects, nested random effects, or crossed random effects. 

```{r, fig.width=4, fig.asp = 1.5}
# Prepare the subset for charismatic participants ahead
charismatic_subset <- d_i_m_sum_all %>% 
  filter(religion == "charismatic")

ggplot() +
  # Jitter for all participants
  geom_jitter(data = d_i_m_sum_all, aes(x = prayfreqmin, y = spev_score, color = religion), 
              height = 0, width = 0.2, alpha = 0.8, size = 1) +
  # Regression line for all participants
  geom_smooth(data = d_i_m_sum_all, aes(x = prayfreqmin, y = spev_score, group = religion, color = religion), 
              method = "lm", se = TRUE, alpha = 0.1) +
  scale_x_continuous(breaks = 1:4, labels = levels(d_i_m_sum_all$prayfreqmin_cat)) +
  scale_y_continuous(breaks = 0:1, labels = c("No", "Yes")) +
  theme(legend.position = "top", 
        axis.title.x = element_text(size=7), 
        axis.text.x = element_text(angle = 20, hjust = 1),
        axis.title.y = element_text(size=12),
        title = element_text(size=8)) +
  scale_color_brewer(palette = "Set2") +
  labs(title = "Study 1, all participants vs. charismatic participants",
       x = "'How many minutes each day do you [pray] on average throughout the week?'",
       y = "Spiritual Events score (mean response)",
       color = "Group") +
  #guides(color = guide_legend(override.aes = list(alpha = 1, size = 2))) + 
  guides(fill = FALSE, color = guide_legend(override.aes = list(alpha = 1, size = 2, fill = NA))) 

```

```{r}
d_i_m_sum_all %>%
  filter(!is.na(prayfreqmin)) %>%
ggplot(aes(x = prayfreqmin, y = spev_score)) +
  geom_jitter(aes(color = religion), 
              height = 0, width = 0.2, alpha = 0.8, size = 1) +
  geom_smooth(aes(group = religion, color = religion), 
              method = "lm", se = TRUE, alpha = 0.1) +
  facet_wrap(~ country, ncol = 5) +  
  scale_x_continuous(breaks = 1:4, labels = levels(d_i_m_sum_all$prayfreqmin_cat)) +
   scale_y_continuous(breaks = 0:1, labels = c("No", "Yes")) +
  scale_color_brewer(palette = "Set2") +
  labs(title = "Study 1, by religion and country",
       x = "'How many minutes each day do you [pray] on average throughout the week?'",
       y = "Spiritual Events Score",
       color = "Group") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), 
        legend.position = "top", 
        axis.title.x = element_text(size = 13), 
        axis.title.y = element_text(size = 18), 
        title = element_text(size = 15))
```

### All participants

```{r}
m.int.a.1 <- lmer(
  scale(spev_score, scale = T) ~ 1 + scale(prayfreqmin, scale = T) 
  + (1|country/site/religion), # fully nested
  # + (1|country/site) + (1|religion), # site nested within country, religion crossed
  data = d_i_m_sum_all)
```

```{r}
parameters(m.int.a.1)
```

### Charismatic Christian participants only 

```{r}
m.int.a.2.1 <- lmer(
  scale(spev_score, scale = T) ~ 1 + scale(prayfreqmin, scale = T) 
  # + (1|country/site/religion), # fully nested
  # + (1|country/site) + (1|religion), # site nested within country, religion crossed
  + (1|country/site), # site nested within country, no religion bc all christian
  data = d_i_m_sum_all %>% filter(religion == "charismatic"))
```

```{r}
parameters(m.int.a.2.1)
```

### Local & charismatic participants, grouped by country

```{r}
d_i_m_sum_all %>%
  filter(!is.na(prayfreqmin)) %>%
ggplot(aes(x = prayfreqmin, y = spev_score)) +
  geom_jitter(aes(color = religion), 
              height = 0, width = 0.2, alpha = 0.8, size = 1) +
  geom_smooth(aes(group = religion, color = religion), 
              method = "lm", se = TRUE, alpha = 0.1) +
  facet_wrap(~ country, ncol = 5) +  
  scale_x_continuous(breaks = 1:4, labels = levels(d_i_m_sum_all$prayfreqmin_cat)) +
  scale_color_brewer(palette = "Set2") +
  labs(title = "Study 1, by religion and country",
       x = "'How many minutes each day do you [pray] on average throughout the week?'",
       y = "Spiritual Events Score",
       color = "Group") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), 
        legend.position = "top", 
        axis.title.x = element_text(size = 13), 
        axis.title.y = element_text(size = 18), 
        title = element_text(size = 15))
```


## Study 2

**An informal summary**: above and beyond differences across countries and samples (charismatic vs. general population), the more frequently a person reported praying, the more spiritual events they reported having experienced. This is robust to many analytic decisions, including modeling responses at the item level vs. modeling average scores on the Spiritual Events scale and considering sample characteristics as fixed or random effects. 

```{r, fig.width=4, fig.asp = 1.5}
d_e_m_f_sum_all <- d_e_m_f_sum_all %>%
  filter(!is.na(population))

# Prepare the subset for charismatic participants ahead
charismatic_subset <- d_e_m_f_sum_all %>% 
  filter(population == "charismatic")

ggplot() +
  # Jitter for all participants colored by country
  geom_jitter(data = d_e_m_f_sum_all, aes(x = prayminday_imp0, y = spev_score_f, color = population), 
              height = 0, width = 0.2, alpha = 0.8, size = 1) +
  # Regression line with confidence interval for all participants
  geom_smooth(data = d_e_m_f_sum_all, aes(x = prayminday_imp0, y = spev_score_f, group = population, color = population), 
              method = "lm", se = TRUE, linetype = "solid", alpha = 0.2) +
  scale_x_continuous(breaks = 0:4, labels = levels(d_e_m_f_sum_all$prayminday_imp0_cat)) +
  scale_y_continuous(breaks = 0:5, labels = c("Never", "Once or\n twice", "At least\n 1/year", "At least\n 1/month", "At least\n 1/week", "Even more")) +
  theme(legend.position = "top",
        axis.text.x = element_text(angle = 20, hjust = 1),
        axis.title.x = element_text(size=6), 
        axis.title.y = element_text(size=12),
        title = element_text(size=8)) +
  scale_color_brewer(palette = "Set2") + # This will automatically apply to the 'color' aesthetic, now mapping to 'country'
  labs(title = "Study 2, all participants vs. charismatic participants",
       x = "'Do you [pray] regularly? On an average day, how many minutes do you [pray]?'\nNOTE: Participants who explicitly reported never praying were assigned 'not at all' (0)",
       y = "Spiritual Events score (mean response)",
       color = "Group") + 
  guides(fill = FALSE, color = guide_legend(override.aes = list(alpha = 1, size = 2, fill = NA))) 
```

```{r}
d_e_m_f_sum_all %>%
  filter(!is.na(prayminday_imp0)) %>%
ggplot(aes(x = prayminday_imp0, y = spev_score_f)) +
  geom_jitter(aes(color = population), 
              height = 0, width = 0.2, alpha = 0.8, size = 1) +
  geom_smooth(aes(group = population, color = population), 
              method = "lm", se = TRUE, alpha = 0.1) +
  facet_wrap(~ country, ncol = 5) +  
  scale_x_continuous(breaks = 0:4, labels = levels(d_e_m_f_sum_all$prayminday_imp0_cat)) +
   scale_y_continuous(breaks = 0:5, labels = c("Never", "Once or\n twice", "At least\n 1/year", "At least\n 1/month", "At least\n 1/week", "Even more")) +
  scale_color_brewer(palette = "Set2") +
  labs(title = "Study 2, by population and country",
       x = "'Do you [pray] regularly? On an average day, how many minutes do you [pray]?'\nNOTE: Participants who explicitly reported never praying were assigned 'not at all' (0)",
       y = "Spiritual Events Score",
       color = "Group") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), 
        legend.position = "top", 
        axis.title.x = element_text(size = 12), 
        axis.title.y = element_text(size = 18), 
        title = element_text(size = 15))
```


### All participants 

```{r}
# controlling for religiosity

m.epi.rel.all.1 <- lmer(
  scale(spev_score_f, scale = T) ~ 1 + scale(prayminday_imp0, scale = T) * scale(howr_num, scale = T)
  + (1|country/population),
  data = d_e_m_f_sum_all)
```

```{r}
parameters(m.epi.rel.all.1)
```

### Charismatic Christians 

```{r}
# controlling for religiosity

m.epi.rel.char.1 <- lmer(
  scale(spev_score_f, scale = T) ~ 1 + scale(prayminday_imp0, scale = T) * scale(howr_num, scale = T)
  + (1|country),
  data = d_e_m_f_sum_all %>% filter(population == "charismatic"),
  contrasts = list(
    country = contr_effect_fun(
      d_e_m_f_sum_all %>% filter(country != "China"), 
      "country", 
      "US")))
```

```{r}
parameters(m.epi.rel.char.1)
```

### General population & charismatic participants, grouped by country

```{r}
d_e_m_f_sum_all %>%
  filter(!is.na(prayminday_imp0)) %>%
ggplot(aes(x = prayminday_imp0, y = spev_score_f)) +
  geom_jitter(aes(color = population), 
              height = 0, width = 0.2, alpha = 0.8, size = 1) +
  geom_smooth(aes(group = population, color = population), 
              method = "lm", se = TRUE, alpha = 0.1) +
  facet_wrap(~ country, ncol = 5) +  
  scale_x_continuous(breaks = 0:4, labels = levels(d_e_m_f_sum_all$prayminday_imp0_cat)) +
  scale_color_brewer(palette = "Set2") +
  labs(title = "Study 2, by population and country",
       x = "'Do you [pray] regularly? On an average day, how many minutes do you [pray]?'\nNOTE: Participants who explicitly reported never praying were assigned 'not at all' (0)",
       y = "Spiritual Events Score",
       color = "Group") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), 
        legend.position = "top", 
        axis.title.x = element_text(size = 13), 
        axis.title.y = element_text(size = 18), 
        title = element_text(size = 15))
```


## Study 3

**An informal summary**: above and beyond differences across denominations, the more frequently a person reported praying, the more spiritual events they reported having experienced. This is robust to many analytic decisions, including [NOT YET CONFIRMED: modeling responses at the item level vs. modeling average scores on the Spiritual Events scale and] considering sample characteristics as fixed vs. random effects. 

```{r, fig.width=4, fig.asp = 1.5}
# Add a new column 'group' to categorize each observation
d_p_m_sum <- d_p_m_sum %>%
  mutate(group = case_when(
    #grepl("Evang", religion_cat) ~ "Evangelical Christian",
    religion_denom == "Christian" ~ "Christians",
    TRUE ~ "All Participants"
  ))

# Plot
ggplot(d_p_m_sum, aes(x = pray_freq_PEW_num, y = spev_score, color = group)) +
  geom_jitter(aes(color = group), height = 0, width = 0.2, alpha = 0.7, size = 0.1) +
  geom_smooth(data = d_p_m_sum %>% filter(group == "All Participants"), aes(group = group),  method = "lm", alpha = 0.2) +
  geom_smooth(data = d_p_m_sum %>% filter(group == "Christians"), aes(group = group),  method = "lm", alpha = 0.1) +
  #geom_smooth(data = d_p_m_sum %>% filter(group == "Evangelical Christian"), aes(group = group),  method = "lm", alpha = 0.1) +
  scale_x_continuous(breaks = 1:7, labels = levels(d_p_m_sum$pray_freq_PEW)) +
  scale_y_continuous(breaks = 0:4, labels = c("Never", "Once", "Several\n times", "Fairly\n often", "Very\n often")) +
  #scale_color_brewer(palette = "Set2") +
  scale_color_manual(values = c("Christians" = "#66C2A5", "All Participants" = "#FC8D62")) +
  theme(legend.position = "top",
        legend.text = element_text(size = 7),
        axis.title.x = element_text(size=8), 
        axis.title.y = element_text(size=12),
        title = element_text(size=7)) +
  #scale_fill_manual(values = group_colors) + # Add this line to manually set fill colors
  theme(axis.text.x = element_text(angle = 20, hjust = 1, vjust = 1)) +
  labs(title = "Study 3, all participants vs. Christian participants",
       x = "'Outside of attending religious services, how often do you pray?'",
       y = "Spiritual Events score (mean response)",
       color = "Group") +
  guides(color = guide_legend(override.aes = list(alpha = 1, size = 2, fill = NA))) 
```

### All participants 

```{r}
# controlling for religiosity

m.pro.rel.all.1 <- lmer(
  scale(spev_score, scale = T) ~ 1 + scale(pray_freq_PEW_num, scale = T) * scale(demo_religimp_num, scale = T)
  + (1|religion_denom), # fully nested
  data = d_p_m_sum %>% left_join(d_p_demo %>% select(ResponseId, demo_religimp_num)))
```

```{r}
parameters(m.pro.rel.all.1)
```

### Christian participants

```{r}
# controlling for religiosity

m.pro.rel.xtian.1 <- lmer(
  scale(spev_score, scale = T) ~ 1 + scale(pray_freq_PEW_num, scale = T) * scale(demo_religimp_num, scale = T)
  + (1|religion_cat), # incl denomination
  data = d_p_m_sum %>% filter(religion_denom == "Christian") %>% 
    left_join(d_p_demo %>% select(ResponseId, demo_religimp_num)))
```

```{r}
parameters(m.pro.rel.xtian.1)
```


# Analysis 2: Prayer Affects Some Spiritual Presence Events More Than Others 

## Study 1 

```{r, fig.width=4, fig.asp = 1.5}
category_colors <- c("relabeled" = "#66c2a5", 
                  "presence" = "#fc8d62", 
                  "outer_sensory" = "#8da0cb")

d_i_m %>%
  filter(!is.na(category), category != "weird") %>%
  group_by(subject_id, prayfreqmin, prayfreqmin_cat, category) %>%
  multi_boot_standard(col = "response", na.rm = T) %>%
  ungroup() %>%
  left_join(
    d_i_m %>%
      group_by(subject_id, category, prayfreqmin_cat) %>%
      summarise(avg_subj_response = mean(response, na.rm = TRUE))
  ) %>%
  left_join(
    d_i_m %>% 
      dplyr::select(subject_id, country)
  ) %>% distinct() %>%
  ggplot(aes(x = prayfreqmin, y = mean, color = category)) +
  geom_jitter(width = 0.2, height = 0.08, size = 0.7, alpha = 0.4) +
  geom_smooth(method = "lm", alpha=0.2) +
  scale_x_continuous(breaks = 1:4, labels = levels(d_i_m_sum$prayfreqmin_cat)) +
  scale_y_continuous(breaks = 0:1, labels = c("No", "Yes")) +
  scale_color_manual(values=category_colors) +
  #scale_color_brewer(palette = "Dark2", na.value = "gray") +
  theme(legend.position = "top",
        legend.text = element_text(size=5.5),
        title = element_text(size=8),
        axis.title.x = element_text(size=7), 
        axis.title.y = element_text(size=12)) +
  theme(axis.text.x = element_text(angle = 20, hjust = 1, vjust = 1)) +
  labs(title = "Study 1, all participants",
       x = "'How many minutes each day do you [pray] on average throughout the week?'",
       y = "Spiritual Events score (mean response)",
       color = "Category of Spiritual Event") +
  guides(fill = FALSE, color = guide_legend(override.aes = list(alpha = 1, size = 2, fill = NA),
                              nrow = 1, byrow = T)) 
```

### Reliability of Categories

```{r}
#cronbach's alpha for the categories 

#interviews

#relabeled
relabeled_int <- d_i_m %>% 
  filter(category == "relabeled") %>%
  dplyr::select(subject_id, question, response) %>% 
  distinct() %>%
  pivot_wider(names_from = question, values_from = response) %>%
  column_to_rownames(var = "subject_id")

#outer_sensory
outer_sensory_int <- d_i_m %>% 
  filter(category == "outer_sensory") %>%
  dplyr::select(subject_id, question, response) %>% 
  distinct() %>%
  pivot_wider(names_from = question, values_from = response) %>%
  column_to_rownames(var = "subject_id")

#presence
presence_int <- d_i_m %>% 
  filter(category == "presence") %>%
  dplyr::select(subject_id, question, response) %>% 
  distinct() %>%
  pivot_wider(names_from = question, values_from = response) %>%
  column_to_rownames(var = "subject_id")

#weird
weird_int <- d_i_m %>% 
  filter(category == "weird") %>%
  dplyr::select(subject_id, question, response) %>% 
  distinct() %>%
  pivot_wider(names_from = question, values_from = response) %>%
  column_to_rownames(var = "subject_id")
```

```{r}
#cronbach's alpha for the categories 
#interview alpha values
alpha(relabeled_int)
alpha(outer_sensory_int)
alpha(presence_int)
alpha(weird_int)
```

### Correlations

```{r}
d_i_m %>% 
  select(subject_id, question, response, prayfreqmin) %>%
  spread(question, response) %>%
  column_to_rownames("subject_id") %>%
  cor(use = "pairwise.complete") %>%
  data.frame() %>%
  rownames_to_column("question") %>%
  filter(question != "prayfreqmin") %>%
  select(question, prayfreqmin) %>%
  rename(cor_prayer = prayfreqmin) %>%
  left_join(d_i_m %>% distinct(question, category)) %>%
  mutate(category = if_else(is.na(category), "(other)", category)) %>%
  group_by(category) %>%
  mutate(MEAN_cor = mean(cor_prayer, na.rm = T)) %>%
  ungroup() %>%
  select(category, MEAN_cor, question, cor_prayer) %>%
  arrange(desc(MEAN_cor), category, desc(cor_prayer)) %>%
  rename(Category = category,
         `Mean R` = MEAN_cor,
         Question = question,
         `Item-wise R` = cor_prayer) %>%
  kbl(digits = 3) %>%
  kable_styling() %>%
  collapse_rows(1:2, valign = "top")

```

### Linear mixed effects models

### All participants

```{r}
m.int.3a.1.1 <- lmer(
  scale(spev_score, scale = T) ~ 1 + category * scale(prayfreqmin, scale = T)
  + (1|country/site/religion/subject_id), # fully nested
  data = d_i_m_sum)
```

```{r}
parameters(m.int.3a.1.1)
```

### Charismatic Christian participants

```{r}
contrasts(d_i_m_sum$category) <- contr_effect_fun(d_i_m_sum, "category", "weird") # drop weird

m.int.3a.2.2 <- lmer(
  scale(spev_score, scale = T) ~ 1 + category * scale(prayfreqmin, scale = T)
  # + (1|country/site/religion/subject_id), # fully nested
  # + (1|country/religion/site/subject_id), # fully nested alt order
  # + (1|country/site/subject_id) + (1|religion), # subject nested within site nested within country, religion crossed
  + (1|country/site/subject_id), # subject nested within site nested within country, no religion bc all christian
  data = d_i_m_sum %>% filter(religion == "charismatic"))
```

```{r}
parameters(m.int.3a.2.2)
```

## Study 2 

```{r, fig.width=5, fig.asp = 1.5}
category_colors <- c("relabeled" = "#66c2a5", 
                  "presence" = "#fc8d62", 
                  "outer_sensory" = "#8da0cb")

d_e_m_f %>%
  filter(!is.na(category), category != "weird") %>%
  group_by(subject_id, prayminday_imp0, prayminday_imp0_cat, category) %>%
  multi_boot_standard(col = "response", na.rm = T) %>%
  ungroup() %>%
  left_join(
    d_e_m_f %>%
      group_by(subject_id, category, prayminday_imp0_cat) %>%
      summarise(avg_subj_response = mean(response, na.rm = TRUE))
  ) %>%
  left_join(
    d_e_m_f %>% 
      dplyr::select(subject_id, country)
  ) %>% distinct() %>%
  ggplot(aes(x = prayminday_imp0, y = mean, color = category)) +
  geom_jitter(width = 0.2, height = 0.1, size = 0.6, alpha = 0.3) +
  geom_smooth(method = "lm", alpha = 0.2) +
  scale_x_continuous(breaks = 0:4, labels = levels(d_e_m_f_sum$prayminday_imp0_cat)) +
  scale_y_continuous(breaks = 0:5, labels = c("Never", "Once or\n twice", "At least\n 1/year", "At least\n 1/month", "At least\n 1/week", "Even more")) +
  scale_color_manual(values = category_colors) +
  #scale_color_brewer(palette = "Dark2", na.value = "gray") +
  theme(legend.position = "top",
        legend.text = element_text(size=6),
        title = element_text(size=8),
        axis.title.x = element_text(size=7), 
        axis.title.y = element_text(size=12)) +
  theme(axis.text.x = element_text(angle = 20, hjust = 1, vjust = 1)) +
  labs(title = "Study 2, all participants",
       x = "'Do you [pray] regularly? On an average day, how many minutes do you [pray]?'\nNOTE: Participants who explictly reported never praying were assigned 'not at all' (0)",
       y = "Spiritual Events score (mean response)",
       color = "Category of Spiritual Event") +
  guides(fill = FALSE, color = guide_legend(override.aes = list(alpha = 1, size = 2, fill=NA),
                              nrow = 1, byrow = T)) 
```

### Reliability of Categories

```{r}
#cronbach's alpha for the categories 
#epi

#relabeled
relabeled_epi <- d_e_m_f %>% 
  filter(category == "relabeled") %>%
  dplyr::select(subject_id, question, response) %>% 
  distinct() %>%
  pivot_wider(names_from = question, values_from = response) %>%
  column_to_rownames(var = "subject_id")

#outer_sensory
outer_sensory_epi <- d_e_m_f %>% 
  filter(category == "outer_sensory") %>%
  dplyr::select(subject_id, question, response) %>% 
  distinct() %>%
  pivot_wider(names_from = question, values_from = response) %>%
  column_to_rownames(var = "subject_id")

#presence
presence_epi <- d_e_m_f %>% 
  filter(category == "presence") %>%
  dplyr::select(subject_id, question, response) %>% 
  distinct() %>%
  pivot_wider(names_from = question, values_from = response) %>%
  column_to_rownames(var = "subject_id")

#weird
weird_epi <- d_e_m_f %>% 
  filter(category == "weird") %>%
  dplyr::select(subject_id, question, response) %>% 
  distinct() %>%
  pivot_wider(names_from = question, values_from = response) %>%
  column_to_rownames(var = "subject_id")
```

```{r}
#cronbach's alpha for the categories 
#epi alpha values
alpha(relabeled_epi)
alpha(outer_sensory_epi)
alpha(presence_epi)
alpha(weird_epi)
```

### Correlations

```{r}
#using frequency data

d_e_m_f %>% 
  select(subject_id, question, response, prayminday_imp0) %>%
  spread(question, response) %>%
  column_to_rownames("subject_id") %>%
  cor(use = "pairwise.complete") %>%
  data.frame() %>%
  rownames_to_column("question") %>%
  filter(question != "prayminday_imp0") %>%
  select(question, prayminday_imp0) %>%
  rename(cor_prayer = prayminday_imp0) %>%
  left_join(d_e_m_f %>% distinct(question, category)) %>%
  mutate(category = if_else(is.na(category), "(other)", category)) %>%
  group_by(category) %>%
  mutate(MEAN_cor = mean(cor_prayer, na.rm = T)) %>%
  ungroup() %>%
  select(category, MEAN_cor, question, cor_prayer) %>%
  arrange(desc(MEAN_cor), category, desc(cor_prayer)) %>%
  rename(Category = category,
         `Mean R` = MEAN_cor,
         Question = question,
         `Item-wise R` = cor_prayer) %>%
  kbl(digits = 3) %>%
  kable_styling() %>%
  collapse_rows(1:2, valign = "top")

```

### Mixed effects models 

#### All participants

```{r}
# controlling for religiosity 

contrasts(d_e_m_f_sum$category) <- contr_effect_fun(d_e_m_f_sum, "category", "weird") # drop weird

m.epi.rel.all <- lmer(
  scale(spev_score_f, scale = T) ~ 1 + category * scale(prayminday_imp0, scale = T) * scale(howr_num, scale = T)
  + (1|country/population/subject_id), # fully nested
  data = d_e_m_f_sum)
```

```{r}
parameters(m.epi.rel.all)
```

#### Charismatic Christian participants

```{r}
# controlling for religiosity 

contrasts(d_e_m_f_sum$category) <- contr_effect_fun(d_e_m_f_sum, "category", "weird") # drop weird

m.epi.rel.char <- lmer(
  scale(spev_score_f, scale = T) ~ 1 + category * scale(prayminday_imp0, scale = T) * scale(howr_num, scale = T)
  + (1|country/subject_id), # fully nested
  data = d_e_m_f_sum %>%
    filter(population == "charismatic") %>%
    mutate(country = factor(
      country,
      levels = c("US", "Ghana", "Thailand", "Vanuatu"))),
  contrasts = list(country = contr_effect_fun(
    d_e_m_f_sum %>%
      filter(country != "China"),
    var_name = "country",
    level_drop = "US")))
```

```{r}
parameters(m.epi.rel.char)
```

## Study 3

```{r,fig.width=4, fig.asp = 1.5}
category_colors <- c("relabeled" = "#66c2a5", 
                  "presence" = "#fc8d62", 
                  "outer_sensory" = "#8da0cb")

d_p_m %>%
  filter(!is.na(category), category != "weird") %>%
  left_join(spev_key) %>%
  group_by(ResponseId, religion_denom, religion_cat, pray_freq_PEW_num, category) %>%
  summarise(score = mean(response, na.rm = T)) %>%
  ungroup() %>%
  filter(!is.na(category)) %>%
  ggplot(aes(x = pray_freq_PEW_num, y = score, color = category)) +
  geom_jitter(width = 0.2, height = 0.1, size = 0.1, alpha = 0.4) +
  geom_smooth(method = "lm", alpha = 0.2) +
  scale_x_continuous(breaks = 1:7, labels = levels(d_p_m_sum$pray_freq_PEW)) +
  scale_y_continuous(breaks = 0:4, labels = c("Never", "Once", "Several\n times", "Fairly\n often", "Very\n often")) +
  scale_color_manual(values = category_colors) +
  #scale_color_brewer(palette = "Dark2", na.value = "gray") +
  theme(legend.position = "top",
        legend.text = element_text(size=4.5),
        title = element_text(size=8),
        axis.title.x = element_text(size=7), 
        axis.title.y = element_text(size=12)) +
  theme(axis.text.x = element_text(angle = 20, hjust = 1, vjust = 1)) +
  labs(title = "Study 3, all participants",
       x = "'Outside of attending religious services, how often do you pray?'",
       y = "Spiritual Events score (mean response)",
       color = "Category of Spiritual Event") +
  guides(fill = FALSE, color = guide_legend(override.aes = list(alpha = 1, size = 2, fill=NA),
                              nrow = 1, byrow = T)) 
```

### Reliability of Categories

```{r}
#relabeled
relabeled_pro <- d_p_m %>% 
  left_join(spev_key) %>%
  filter(category == "relabeled") %>%
  dplyr::select(ResponseId, question, response) %>% 
  distinct() %>%
  pivot_wider(names_from = question, values_from = response) %>%
  column_to_rownames(var = "ResponseId")

#outer_sensory
outer_sensory_pro <- d_p_m %>% 
  filter(category == "outer_sensory") %>%
  dplyr::select(ResponseId, question, response) %>% 
  distinct() %>%
  pivot_wider(names_from = question, values_from = response) %>%
  column_to_rownames(var = "ResponseId")

#presence
presence_pro <- d_p_m %>% 
  filter(category == "presence") %>%
  dplyr::select(ResponseId, question, response) %>% 
  distinct() %>%
  pivot_wider(names_from = question, values_from = response) %>%
  column_to_rownames(var = "ResponseId")

#weird
weird_pro <- d_p_m %>% 
  filter(category == "weird") %>%
  dplyr::select(ResponseId, question, response) %>% 
  distinct() %>%
  pivot_wider(names_from = question, values_from = response) %>%
  column_to_rownames(var = "ResponseId")
```

```{r}
#prolific alphas
alpha(relabeled_pro)
alpha(outer_sensory_pro)
alpha(presence_pro)
alpha(weird_pro)
```

### Correlations

```{r}
d_p_m %>% 
  select(ResponseId, question_lab, response, pray_freq_PEW_num) %>%
  spread(question_lab, response) %>%
  column_to_rownames("ResponseId") %>%
  cor(use = "pairwise.complete") %>%
  data.frame() %>%
  rownames_to_column("question_lab") %>%
  filter(question_lab != "pray_freq_PEW_num") %>%
  select(question_lab, pray_freq_PEW_num) %>%
  rename(cor_prayer = pray_freq_PEW_num) %>%
  left_join(d_p_m %>% distinct(question_lab, category)) %>%
  mutate(category = if_else(is.na(category), "(other)", category)) %>%
  group_by(category) %>%
  mutate(MEAN_cor = mean(cor_prayer, na.rm = T)) %>%
  ungroup() %>%
  select(category, MEAN_cor, question_lab, cor_prayer) %>%
  arrange(desc(MEAN_cor), category, desc(cor_prayer)) %>%
  rename(Category = category,
         `Mean R` = MEAN_cor,
         Question = question_lab,
         `Item-wise R` = cor_prayer) %>%
  kbl(digits = 3) %>%
  kable_styling() %>%
  collapse_rows(1:2, valign = "top")


tabledata <- d_p_m %>% 
  select(ResponseId, question_lab, response, pray_freq_PEW_num) %>%
  spread(question_lab, response) %>%
  column_to_rownames("ResponseId") %>%
  cor(use = "pairwise.complete") %>%
  data.frame() %>%
  rownames_to_column("question_lab") %>%
  filter(question_lab != "pray_freq_PEW_num") %>%
  select(question_lab, pray_freq_PEW_num) %>%
  rename(cor_prayer = pray_freq_PEW_num) %>%
  left_join(d_p_m %>% distinct(question_lab, category)) %>%
  mutate(category = if_else(is.na(category), "(other)", category)) %>%
  group_by(category) %>%
  mutate(MEAN_cor = mean(cor_prayer, na.rm = T)) %>%
  ungroup() %>%
  select(category, MEAN_cor, question_lab, cor_prayer) %>%
  arrange(desc(MEAN_cor), category, desc(cor_prayer)) %>%
  rename(Category = category,
         `Mean R` = MEAN_cor,
         Question = question_lab,
         `Item-wise R` = cor_prayer) 

write.csv(tabledata, "s3table.csv", row.names = F)
```


### Mixed effects models 

#### All participants 

```{r}
# category-level "scores"
# controlling for religiosity 

m.pro.rel.all <- lmer(
  scale(score, scale = T) ~ 1 + category * scale(pray_freq_PEW_num, scale = T) * scale(demo_religimp_num, scale = T)
  + (1|religion_denom/ResponseId), 
  data = d_p_m %>% 
    group_by(ResponseId, religion_denom, pray_freq_PEW_num, category) %>%
    summarise(score = mean(response, na.rm = T)) %>% 
    left_join(d_p_demo %>% select(ResponseId, demo_religimp_num)),
  contrasts = list(category = contr_effect_fun(d_p_m, "category", "weird")))
```

```{r}
parameters(m.pro.rel.all)
```

#### All Christians

```{r}
# category-level "scores"
# controlling for religiosity 

m.pro.rel.xtian <- lmer(
  scale(score, scale = T) ~ 1 + category * scale(pray_freq_PEW_num, scale = T) * scale(demo_religimp_num, scale = T)
  + (1|religion_cat/ResponseId), 
  data = d_p_m %>% 
    filter(religion_denom == "Christian") %>%
    group_by(ResponseId, religion_denom, religion_cat, pray_freq_PEW_num, category) %>%
    summarise(score = mean(response, na.rm = T)) %>% 
    left_join(d_p_demo %>% select(ResponseId, demo_religimp_num)),
  contrasts = list(category = contr_effect_fun(d_p_m, "category", "weird")))
```

```{r}
parameters(m.pro.rel.xtian)
```


# Additional Visualizations

## Prayer affects the number of experiences

### Study 1

```{r}
# Prayer affects the number of experiences
d1 <- d_i_m %>%
  mutate(response_yesno = ifelse(response > 0, 1, 0)) %>%
  group_by(subject_id, country, prayfreqmin, prayfreqmin_cat) %>%
  summarise(sum_yes = sum(response_yesno, na.rm = T),
            mean_freq_all = mean(response, na.rm = T)) %>%
  ungroup()
```

```{r, fig.width = 8}
#prayer affects the number of experiences --overall 
d1 %>%
  filter(!is.na(prayfreqmin)) %>%
  ggplot(aes(x = prayfreqmin, y = sum_yes)) +
  geom_jitter(height = 0.2, width = 0.1, 
              size = 1, alpha = 0.5, color = "dodgerblue") +
  geom_pointrange(
    data = . %>% group_by(prayfreqmin) %>%
      multi_boot_standard(col = "sum_yes", na.rm = T) %>%
      ungroup(),
    aes(y = mean, ymin = ci_lower, ymax = ci_upper)) +
  scale_x_continuous(breaks = 1:4, labels = levels(d_i_m_sum$prayfreqmin_cat)) +
  scale_color_brewer(palette = "Set2") +
  scale_y_continuous(breaks = seq(0, 30, 2)) +
  labs(title = "Prayer affects the number of experiences",
       subtitle = "Study 1, all participants",
       caption = "Error bars are bootstrapped 95% CIs",
       x = "'How many minutes each day do you [pray] on average throughout the week?'",
       y = "Number of experiences endorsed")
```

```{r}
# Prayer affects the number of experiences
d1_char <- d_i_m %>%
  filter(religion == "charismatic") %>% 
  mutate(response_yesno = ifelse(response > 0, 1, 0)) %>%
  group_by(subject_id, country, prayfreqmin, prayfreqmin_cat) %>%
  summarise(sum_yes = sum(response_yesno, na.rm = T),
            mean_freq_all = mean(response, na.rm = T)) %>%
  ungroup()
```

```{r, fig.width = 8}
#prayer affects the number of experiences --overall 
d1_char %>%
  filter(!is.na(prayfreqmin)) %>%
  ggplot(aes(x = prayfreqmin, y = sum_yes)) +
  geom_jitter(height = 0.2, width = 0.1, 
              size = 1, alpha = 0.5, color = "dodgerblue") +
  geom_pointrange(
    data = . %>% group_by(prayfreqmin) %>%
      multi_boot_standard(col = "sum_yes", na.rm = T) %>%
      ungroup(),
    aes(y = mean, ymin = ci_lower, ymax = ci_upper)) +
  scale_x_continuous(breaks = 1:4, labels = levels(d_i_m_sum$prayfreqmin_cat)) +
  scale_color_brewer(palette = "Set2") +
  scale_y_continuous(breaks = seq(0, 30, 2)) +
  labs(title = "Prayer affects the number of experiences",
       subtitle = "Study 1, charismatic Christian participants",
       caption = "Error bars are bootstrapped 95% CIs",
       x = "'How many minutes each day do you [pray] on average throughout the week?'",
       y = "Number of experiences endorsed")
```

### Study 2

```{r}
# Prayer affects the number of experiences
d2 <- d_e_m %>%
  mutate(response_yesno = ifelse(response > 0, 1, 0)) %>%
  group_by(subject_id, country, prayminday_imp0, prayminday_imp0_cat) %>%
  summarise(sum_yes = sum(response_yesno, na.rm = T),
            mean_freq_all = mean(response, na.rm = T)) %>%
  ungroup()
```

```{r, fig.width = 8}
#prayer affects the number of experiences --overall 
d2 %>%
  filter(!is.na(prayminday_imp0)) %>%
  ggplot(aes(x = prayminday_imp0, y = sum_yes)) +
  geom_jitter(height = 0.2, width = 0.1, 
              size = 1, alpha = 0.5, color = "dodgerblue") +
  geom_pointrange(
    data = . %>% group_by(prayminday_imp0) %>%
      multi_boot_standard(col = "sum_yes", na.rm = T) %>%
      ungroup(),
    aes(y = mean, ymin = ci_lower, ymax = ci_upper)) +
  scale_x_continuous(breaks = 0:4, labels = levels(d_e_m_sum$prayminday_imp0_cat)) +
  scale_color_brewer(palette = "Set2") +
  scale_y_continuous(breaks = seq(0, 30, 2)) +
  labs(title = "Prayer affects the number of experiences",
       subtitle = "Study 2, all participants",
       caption = "Error bars are bootstrapped 95% CIs",
       x = "'Do you [pray] regularly? On an average day, how many minutes do you [pray]?'\nNOTE: Participants who explictly reported never praying were assigned 'not at all' (0)",
       y = "Number of experiences endorsed")
```

```{r}
# Prayer affects the number of experiences
d2_char <- d_e_m %>%
  filter(population == "charismatic") %>%
  mutate(response_yesno = ifelse(response > 0, 1, 0)) %>%
  group_by(subject_id, country, prayminday_imp0, prayminday_imp0_cat) %>%
  summarise(sum_yes = sum(response_yesno, na.rm = T),
            mean_freq_all = mean(response, na.rm = T)) %>%
  ungroup()
```

```{r, fig.width = 8}
#prayer affects the number of experiences --overall 
d2_char %>%
  filter(!is.na(prayminday_imp0)) %>%
  ggplot(aes(x = prayminday_imp0, y = sum_yes)) +
  geom_jitter(height = 0.2, width = 0.1, 
              size = 1, alpha = 0.5, color = "dodgerblue") +
  geom_pointrange(
    data = . %>% group_by(prayminday_imp0) %>%
      multi_boot_standard(col = "sum_yes", na.rm = T) %>%
      ungroup(),
    aes(y = mean, ymin = ci_lower, ymax = ci_upper)) +
  scale_x_continuous(breaks = 0:4, labels = levels(d_e_m_sum$prayminday_imp0_cat)) +
  scale_color_brewer(palette = "Set2") +
  scale_y_continuous(breaks = seq(0, 30, 2)) +
  labs(title = "Prayer affects the number of experiences",
       subtitle = "Study 2, charismatic Christian participants",
       caption = "Error bars are bootstrapped 95% CIs",
       x = "'Do you [pray] regularly? On an average day, how many minutes do you [pray]?'\nNOTE: Participants who explictly reported never praying were assigned 'not at all' (0)",
       y = "Number of experiences endorsed")
```

### Study 3

```{r}
# Prayer affects the number of experiences
d3 <- d_p_m %>%
  mutate(response_yesno = ifelse(response > 0, 1, 0)) %>%
  group_by(ResponseId, pray_freq_PEW_num, pray_freq_PEW) %>%
  summarise(sum_yes = sum(response_yesno, na.rm = T),
            mean_freq_all = mean(response, na.rm = T)) %>%
  ungroup()
```

```{r, fig.width = 8}
#prayer affects the number of experiences --overall 
d3 %>%
  filter(!is.na(pray_freq_PEW_num)) %>%
  ggplot(aes(x = pray_freq_PEW_num, y = sum_yes)) +
  geom_jitter(height = 0.2, width = 0.1, 
              size = 1, alpha = 0.5, color = "dodgerblue") +
  geom_pointrange(
    data = . %>% group_by(pray_freq_PEW_num) %>%
      multi_boot_standard(col = "sum_yes", na.rm = T) %>%
      ungroup(),
    aes(y = mean, ymin = ci_lower, ymax = ci_upper)) +
  scale_x_continuous(breaks = 1:7, labels = levels(d_p_m_sum$pray_freq_PEW)) +
  scale_color_brewer(palette = "Set2") +
  scale_y_continuous(breaks = seq(0, 30, 2)) +
  labs(title = "Prayer affects the number of experiences",
       subtitle = "Study 3, all participants",
       caption = "Error bars are bootstrapped 95% CIs",
       x = "'Outside of attending religious services, how often do you pray?'",
       y = "Number of experiences endorsed")
```

```{r}
# Prayer affects the number of experiences
d3_xtian <- d_p_m %>%
  filter(religion_denom == "Christian") %>%
  mutate(response_yesno = ifelse(response > 0, 1, 0)) %>%
  group_by(ResponseId, pray_freq_PEW_num, pray_freq_PEW) %>%
  summarise(sum_yes = sum(response_yesno, na.rm = T),
            mean_freq_all = mean(response, na.rm = T)) %>%
  ungroup()
```

```{r, fig.width = 8}
#prayer affects the number of experiences --overall 
d3_xtian %>%
  filter(!is.na(pray_freq_PEW_num)) %>%
  ggplot(aes(x = pray_freq_PEW_num, y = sum_yes)) +
  geom_jitter(height = 0.2, width = 0.1, 
              size = 1, alpha = 0.5, color = "dodgerblue") +
  geom_pointrange(
    data = . %>% group_by(pray_freq_PEW_num) %>%
      multi_boot_standard(col = "sum_yes", na.rm = T) %>%
      ungroup(),
    aes(y = mean, ymin = ci_lower, ymax = ci_upper)) +
  scale_x_continuous(breaks = 1:7, labels = levels(d_p_m_sum$pray_freq_PEW)) +
  scale_color_brewer(palette = "Set2") +
  scale_y_continuous(breaks = seq(0, 30, 2)) +
  labs(title = "Prayer affects the number of experiences",
       subtitle = "Study 3, Christian participants",
       caption = "Error bars are bootstrapped 95% CIs",
       x = "'Outside of attending religious services, how often do you pray?'",
       y = "Number of experiences endorsed")
```

```{r}
# Prayer affects the number of experiences
d3_evang <- d_p_m %>%
  filter(grepl("Evang", religion_cat)) %>%
  mutate(response_yesno = ifelse(response > 0, 1, 0)) %>%
  group_by(ResponseId, pray_freq_PEW_num, pray_freq_PEW) %>%
  summarise(sum_yes = sum(response_yesno, na.rm = T),
            mean_freq_all = mean(response, na.rm = T)) %>%
  ungroup()
```

```{r, fig.width = 8}
#prayer affects the number of experiences --overall 
d3_evang %>%
  filter(!is.na(pray_freq_PEW_num)) %>%
  ggplot(aes(x = pray_freq_PEW_num, y = sum_yes)) +
  geom_jitter(height = 0.2, width = 0.1, 
              size = 1, alpha = 0.5, color = "dodgerblue") +
  geom_pointrange(
    data = . %>% group_by(pray_freq_PEW_num) %>%
      multi_boot_standard(col = "sum_yes", na.rm = T) %>%
      ungroup(),
    aes(y = mean, ymin = ci_lower, ymax = ci_upper)) +
  scale_x_continuous(breaks = 1:7, labels = levels(d_p_m_sum$pray_freq_PEW)) +
  scale_color_brewer(palette = "Set2") +
  scale_y_continuous(breaks = seq(0, 30, 2)) +
  labs(title = "Prayer affects the number of experiences",
       subtitle = "Study 3, evangelical participants",
       caption = "Error bars are bootstrapped 95% CIs",
       x = "'Outside of attending religious services, how often do you pray?'",
       y = "Number of experiences endorsed")
```


## Prayer and Sleep Paralysis

### Study 1 

```{r}
d_i_m %>%
  filter(!is.na(prayfreqmin)) %>%
  filter(category == "weird") %>%
  filter(question == "sleep_paralysis") %>%
  distinct(subject_id, country, site, religion, 
           prayfreqmin, prayfreqmin_cat, 
           question, response) %>%
  mutate(
    response_cat = factor(
      response, 
      exclude = F, 
      levels = c(NA, "0", "1"),
      labels = c("NA", "no", "yes"))) %>%
  ggplot(aes(x = prayfreqmin_cat, 
             alpha = response_cat)) +
  facet_grid(cols = vars(question)) +
  geom_bar(position = "fill", color = "black", size = 0.2) +
  scale_y_continuous(labels = scales:: label_percent()) +
  scale_alpha_manual(values = c(0, 0.2, 0.9)) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(title = "Study 1: All participants",
       #subtitle = "All participants",
       x = "Prayer", 
       y = "Percent of responses", 
       alpha = "Response")
```

```{r}
d_i_m %>%
  filter(!is.na(prayfreqmin), religion == "charismatic") %>%
  filter(category == "weird") %>%
  filter(question == "sleep_paralysis") %>%
  distinct(subject_id, country, site, religion, 
           prayfreqmin, prayfreqmin_cat, 
           question, response) %>%
  mutate(
    response_cat = factor(
      response, 
      exclude = F, 
      levels = c(NA, "0", "1"),
      labels = c("NA", "no", "yes"))) %>%
  ggplot(aes(x = prayfreqmin_cat, 
             alpha = response_cat)) +
  facet_grid(cols = vars(question)) +
  geom_bar(position = "fill", color = "black", size = 0.2) +
  scale_y_continuous(labels = scales:: label_percent()) +
  scale_alpha_manual(values = c(0, 0.2, 0.9)) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(title = "Study 1: charismatic Christians",
       #subtitle = "charismatic Christians",
       x = "Prayer", 
       y = "Percent of responses", 
       alpha = "Response")
```

### Study 2

```{r}
d_e_m %>%
  filter(!is.na(prayminday_imp0)) %>%
  filter(category == "weird") %>%
  filter(question == "sleep_paralysis") %>%
  distinct(subject_id, country, population, 
           prayminday_imp0, prayminday_imp0_cat, 
           question, response) %>%
  mutate(
    response_cat = factor(
      response, 
      exclude = F, 
      levels = c(NA, "0", "1"),
      labels = c("NA", "no", "yes"))) %>%
  ggplot(aes(x = prayminday_imp0_cat, 
             alpha = response_cat)) +
  facet_grid(cols = vars(question)) +
  geom_bar(position = "fill", color = "black", size = 0.2) +
  scale_y_continuous(labels = scales:: label_percent()) +
  scale_alpha_manual(values = c(0, 0.2, 0.9)) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(title = "Study 2: All participants",
       x = "Prayer", 
       y = "Percent of responses", 
       alpha = "Response")
```


```{r}
d_e_m %>%
  filter(!is.na(prayminday_imp0), population == "charismatic") %>%
  filter(category == "weird") %>%
  filter(question == "sleep_paralysis") %>%
  distinct(subject_id, country, population, 
           prayminday_imp0, prayminday_imp0_cat, 
           question, response) %>%
  mutate(
    response_cat = factor(
      response, 
      exclude = F, 
      levels = c(NA, "0", "1"),
      labels = c("NA", "no", "yes"))) %>%
  ggplot(aes(x = prayminday_imp0_cat, 
             alpha = response_cat)) +
  facet_grid(cols = vars(question)) +
  geom_bar(position = "fill", color = "black", size = 0.2) +
  scale_y_continuous(labels = scales:: label_percent()) +
  scale_alpha_manual(values = c(0, 0.2, 0.9)) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(title = "Study 2: charismatic Christians",
       x = "Prayer", 
       y = "Percent of responses", 
       alpha = "Response")
```

### Study 3

```{r}
d_p_m %>%
  filter(!is.na(pray_freq_PEW)) %>%
  filter(category == "weird") %>%
  filter(question_lab == "sleep_paralysis") %>%
  distinct(ResponseId, pray_freq_PEW, pray_freq_PEW_num, 
           question_lab, response) %>%
  mutate(
    response_yesno = ifelse(response > 0, 1, 0),
    response_cat = factor(
      response_yesno, 
      exclude = F, 
      levels = c(NA, "0", "1"),
      labels = c("NA", "no", "yes"))) %>%
  ggplot(aes(x = pray_freq_PEW, 
             alpha = response_cat)) +
  facet_grid(cols = vars(question_lab)) +
  geom_bar(position = "fill", color = "black", size = 0.2) +
  scale_y_continuous(labels = scales:: label_percent()) +
  scale_alpha_manual(values = c(0, 0.2, 0.9)) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(title = "Study 3: All participants",
       x = "Prayer", 
       y = "Percent of responses", 
       alpha = "Response")
```

```{r}
d_p_m %>%
  filter(!is.na(pray_freq_PEW)) %>%
  filter(religion_denom == "Christian") %>%
  filter(category == "weird") %>%
  filter(question_lab == "sleep_paralysis") %>%
  distinct(ResponseId, pray_freq_PEW, pray_freq_PEW_num, 
           question_lab, response) %>%
  mutate(
    response_yesno = ifelse(response > 0, 1, 0),
    response_cat = factor(
      response_yesno, 
      exclude = F, 
      levels = c(NA, "0", "1"),
      labels = c("NA", "no", "yes"))) %>%
  ggplot(aes(x = pray_freq_PEW, 
             alpha = response_cat)) +
  facet_grid(cols = vars(question_lab)) +
  geom_bar(position = "fill", color = "black", size = 0.2) +
  scale_y_continuous(labels = scales:: label_percent()) +
  scale_alpha_manual(values = c(0, 0.2, 0.9)) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(title = "Study 3: All Christian participants",
       x = "Prayer", 
       y = "Percent of responses", 
       alpha = "Response")
```

```{r}
d_p_m %>%
  filter(!is.na(pray_freq_PEW)) %>%
  filter(grepl("Evang", religion_cat)) %>%
  filter(category == "weird") %>%
  filter(question_lab == "sleep_paralysis") %>%
  distinct(ResponseId, pray_freq_PEW, pray_freq_PEW_num, 
           question_lab, response) %>%
  mutate(
    response_yesno = ifelse(response > 0, 1, 0),
    response_cat = factor(
      response_yesno, 
      exclude = F, 
      levels = c(NA, "0", "1"),
      labels = c("NA", "no", "yes"))) %>%
  ggplot(aes(x = pray_freq_PEW, 
             alpha = response_cat)) +
  facet_grid(cols = vars(question_lab)) +
  geom_bar(position = "fill", color = "black", size = 0.2) +
  scale_y_continuous(labels = scales:: label_percent()) +
  scale_alpha_manual(values = c(0, 0.2, 0.9)) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(title = "Study 3: Only evangelical participants",
       x = "Prayer", 
       y = "Percent of responses", 
       alpha = "Response")
```

## Culture and Dramatic Events

### Study 1

```{r}
d_i_m_sum %>%
  filter(!is.na(category)) %>%
  ggplot(aes(x = category, y = spev_score)) +
  geom_jitter(height = 0.2, width = 0.1, 
              size = 1, alpha = 0.3, color = "dodgerblue") +
  geom_pointrange(
    data = . %>% group_by(country, category) %>%
      multi_boot_standard(col = "spev_score", na.rm = T) %>%
      ungroup(),
    aes(y = mean, ymin = ci_lower, ymax = ci_upper)) +
  facet_wrap(~ country, ncol = 5) +  
  scale_color_brewer(palette = "Set2") +
  #scale_y_continuous(breaks = seq(0, 30, 2)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Categories of Experience by Country",
       subtitle = "Study 1 All Participants",
       caption = "Error bars are bootstrapped 95% CIs",
       x = "Country",
       y = "Spiritual Experience Score")
```

```{r}
d_i_m_sum %>%
  filter(category == "weird") %>%
  ggplot(aes(x = country, y = spev_score)) +
  geom_jitter(height = 0.2, width = 0.1, 
              size = 1, alpha = 0.3, color = "dodgerblue") +
  geom_pointrange(
    data = . %>% group_by(country) %>%
      multi_boot_standard(col = "spev_score", na.rm = T) %>%
      ungroup(),
    aes(y = mean, ymin = ci_lower, ymax = ci_upper)) +
  scale_color_brewer(palette = "Set2") +
  #scale_y_continuous(breaks = seq(0, 30, 2)) +
  labs(title = "Weird Experiences by Country",
       subtitle = "Study 1 All Participants",
       caption = "Error bars are bootstrapped 95% CIs",
       x = "Country",
       y = "Spiritual Experience Score")
```

```{r}
d_i_m %>%
  filter(category == "weird") %>%
  ggplot(aes(x = question, y = response)) +
  geom_jitter(height = 0.1, width = 0.1, 
              size = 1, alpha = 0.3, color = "dodgerblue") +
  geom_pointrange(
    data = . %>% group_by(country, question) %>%
      multi_boot_standard(col = "response", na.rm = T) %>%
      ungroup(),
    aes(y = mean, ymin = ci_lower, ymax = ci_upper)) +
  facet_wrap(~ country, ncol = 5) +  
  scale_color_brewer(palette = "Set2") +
  #scale_y_continuous(breaks = seq(0, 30, 2)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Weird Experiences by Question by Country",
       subtitle = "Study 1 All Participants",
       caption = "Error bars are bootstrapped 95% CIs",
       x = "Country",
       y = "Spiritual Experience Score")
```

### Study 2

```{r}
d_e_m_sum %>%
  filter(category == "weird") %>%
  ggplot(aes(x = country, y = spev_score)) +
  geom_jitter(height = 0.2, width = 0.1, 
              size = 1, alpha = 0.3, color = "dodgerblue") +
  geom_pointrange(
    data = . %>% group_by(country) %>%
      multi_boot_standard(col = "spev_score", na.rm = T) %>%
      ungroup(),
    aes(y = mean, ymin = ci_lower, ymax = ci_upper)) +
  scale_color_brewer(palette = "Set2") +
  #scale_y_continuous(breaks = seq(0, 30, 2)) +
  labs(title = "Weird Experiences by Country",
       subtitle = "Study 2 All Participants",
       caption = "Error bars are bootstrapped 95% CIs",
       x = "Country",
       y = "Spiritual Experience Score")
```

```{r}
d_e_m_sum %>%
  filter(!is.na(category)) %>%
  ggplot(aes(x = category, y = spev_score)) +
  geom_jitter(height = 0.2, width = 0.1, 
              size = 1, alpha = 0.3, color = "dodgerblue") +
  geom_pointrange(
    data = . %>% group_by(country, category) %>%
      multi_boot_standard(col = "spev_score", na.rm = T) %>%
      ungroup(),
    aes(y = mean, ymin = ci_lower, ymax = ci_upper)) +
  facet_wrap(~ country, ncol = 5) +  
  scale_color_brewer(palette = "Set2") +
  #scale_y_continuous(breaks = seq(0, 30, 2)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Categories by Country",
       subtitle = "Study 2 All Participants",
       caption = "Error bars are bootstrapped 95% CIs",
       x = "Country",
       y = "Spiritual Experience Score")
```

```{r}
d_e_m_f %>%
  filter(category == "weird") %>%
  ggplot(aes(x = question, y = response)) +
  geom_jitter(height = 0.2, width = 0.1, 
              size = 1, alpha = 0.3, color = "dodgerblue") +
  geom_pointrange(
    data = . %>% group_by(country, question) %>%
      multi_boot_standard(col = "response", na.rm = T) %>%
      ungroup(),
    aes(y = mean, ymin = ci_lower, ymax = ci_upper)) +
  facet_wrap(~ country, ncol = 5) +  
  scale_color_brewer(palette = "Set2") +
  #scale_y_continuous(breaks = seq(0, 30, 2)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Weird Experiences by Question by Country",
       subtitle = "Study 2 All Participants",
       caption = "Error bars are bootstrapped 95% CIs",
       x = "Country",
       y = "Spiritual Experience Score")
```
